<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æƒ…ä¾£å¤§å¯Œç¿ - æ‰‹æœºç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #1a1023 0%, #2d1b41 100%);
            min-height: 100vh;
            color: #f8f3f9;
            padding: 15px 10px;
            overflow-x: hidden;
            position: relative;
            font-size: 14px;
        }

        /* é¡¶éƒ¨æ ‡é¢˜ */
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px 0;
        }

        .header h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, #ff87ab, #d946ef, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 0.9rem;
            color: #d0c4db;
            opacity: 0.8;
        }

        /* ç©å®¶ä¿¡æ¯å¡ç‰‡ */
        .players-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .player-card {
            flex: 1;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .player-card.active {
            border-color: #ff87ab;
            box-shadow: 0 0 20px rgba(255, 135, 171, 0.3);
            transform: translateY(-3px);
        }

        .player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ff87ab, #d946ef);
        }

        .player-card.player1::before {
            background: linear-gradient(90deg, #ff87ab, #d946ef);
        }

        .player-card.player2::before {
            background: linear-gradient(90deg, #8b5cf6, #6366f1);
        }

        .player-info {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 12px;
            border: 2px solid white;
        }

        .player1 .player-avatar {
            background: linear-gradient(135deg, #ff87ab, #d946ef);
        }

        .player2 .player-avatar {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
        }

        .player-name {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .player-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            gap: 8px;
        }

        .stat {
            text-align: center;
            flex: 1;
            padding: 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #a78bfa;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .player-score {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(90deg, #ff87ab, #d946ef);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            padding: 5px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* æ£‹ç›˜åŒºåŸŸ - é€‚é…æ‰‹æœº */
        .board-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 3px;
            aspect-ratio: 1;
            max-width: 100%;
            margin: 0 auto;
        }

        .cell {
            background: rgba(255, 255, 255, 0.06);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.05);
            color: #e0d6e6;
            min-height: 35px;
        }

        .cell-number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .player-marker {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            position: absolute;
            font-size: 0.6rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1.5px solid white;
        }

        .player1-marker {
            background: linear-gradient(135deg, #ff87ab, #d946ef);
            bottom: 2px;
            left: 2px;
        }

        .player2-marker {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            bottom: 2px;
            right: 2px;
        }

        /* æ¸¸æˆæ§åˆ¶åŒºåŸŸ */
        .game-controls {
            background: linear-gradient(135deg, rgba(217, 70, 239, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 135, 171, 0.2);
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(217, 70, 239, 0.1);
        }

        .turn-indicator {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            background: linear-gradient(90deg, #ff87ab, #d946ef);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 25px;
            padding: 12px 15px;
            background-color: rgba(255, 135, 171, 0.08);
            border-radius: 12px;
            border: 1px solid rgba(255, 135, 171, 0.2);
        }

        .dice-section {
            text-align: center;
            margin-bottom: 25px;
        }

        .dice {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #ff87ab, #d946ef);
            border-radius: 15px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(217, 70, 239, 0.3);
            user-select: none;
            -webkit-user-select: none;
            border: none;
            color: white;
            margin-bottom: 15px;
        }

        .dice:active {
            transform: scale(0.95);
        }

        .dice.rolling {
            animation: roll 0.6s ease-in-out infinite;
        }

        @keyframes roll {
            0% { transform: rotate(0deg) scale(1.05); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(1.05); }
            75% { transform: rotate(270deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1.05); }
        }

        .dice-result {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ff87ab;
        }

        /* ä»»åŠ¡é¢æ¿ */
        .task-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 135, 171, 0.15);
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-title {
            font-size: 1rem;
            font-weight: bold;
            color: #ff87ab;
        }

        .position-indicator {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .task-text {
            font-size: 1.1rem;
            line-height: 1.5;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            flex-direction: column;
        }

        .action-btn-row {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            flex: 1;
            padding: 16px 14px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 52px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .action-btn:active {
            transform: translateY(2px);
        }

        .complete-btn {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            box-shadow: 0 4px 10px rgba(34, 197, 94, 0.2);
        }

        .skip-btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            box-shadow: 0 4px 10px rgba(245, 158, 11, 0.2);
        }

        .skip-btn:disabled {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        .skip-count {
            font-size: 0.8rem;
            margin-top: 6px;
            color: #fbbf24;
            text-align: center;
        }

        /* æ¸¸æˆä¿¡æ¯æ  */
        .game-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            background: transparent;
            border-radius: 15px;
            padding: 0;
            border: none;
            margin-bottom: 20px;
            gap: 12px;
        }

        .info-item {
            text-align: center;
            padding: 15px 12px;
            background: linear-gradient(135deg, rgba(255, 135, 171, 0.05), rgba(139, 92, 246, 0.05));
            border-radius: 12px;
            border: 1px solid rgba(255, 135, 171, 0.15);
            backdrop-filter: blur(5px);
        }

        .info-label {
            font-size: 0.75rem;
            color: #a78bfa;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            font-size: 1.4rem;
            font-weight: bold;
            background: linear-gradient(90deg, #ff87ab, #d946ef);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* é‡ç½®æŒ‰é’® */
        .reset-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #8b5cf6, #d946ef);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(139, 92, 246, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .reset-btn:active {
            transform: translateY(2px);
        }

        /* åº•éƒ¨ä¿¡æ¯ */
        .footer {
            text-align: center;
            font-size: 0.8rem;
            color: #a78bfa;
            padding: 15px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 10px;
        }

        /* æ¨¡æ€æ¡†ï¼ˆæ¸¸æˆç»“æŸï¼‰ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: linear-gradient(135deg, #2d1b41, #1a1023);
            border-radius: 20px;
            padding: 30px 25px;
            max-width: 400px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-title {
            font-size: 1.8rem;
            background: linear-gradient(90deg, #ff87ab, #d946ef);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 20px;
        }

        .modal-content {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #f0e6f9;
        }

        .modal-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .modal-btn:active {
            transform: translateY(2px);
        }

        /* æ¨ªå‘æ¨¡å¼é€‚é… */
        @media (orientation: landscape) and (max-height: 600px) {
            .board-container {
                display: none;
            }
            
            .players-container {
                margin-bottom: 10px;
            }
            
            .player-card {
                padding: 10px 15px;
            }
            
            .game-controls {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .task-panel {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .task-text {
                min-height: 60px;
                font-size: 1rem;
            }
            
            .action-btn {
                padding: 12px;
                font-size: 0.9rem;
            }
        }

        /* å¹³æ¿é€‚é… */
        @media (min-width: 768px) {
            body {
                max-width: 600px;
                margin: 0 auto;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .cell {
                min-height: 45px;
            }
            
            .dice {
                width: 110px;
                height: 110px;
                font-size: 44px;
            }
        }

        /* é˜²æ­¢é•¿æŒ‰èœå• */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* å…è®¸æ–‡æœ¬é€‰æ‹© */
        .task-text {
            -webkit-user-select: text;
            user-select: text;
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <div class="header">
        <h1>ğŸ’‘ æƒ…ä¾£å¤§å¯Œç¿</h1>
        <div class="subtitle">åŒäººæ‰‹æœºç‰ˆ Â· ç§å¯†äº’åŠ¨æ¸¸æˆ</div>
    </div>
    
    <!-- ç©å®¶ä¿¡æ¯ -->
    <div class="players-container">
        <div class="player-card player1 active" id="player1Card">
            <div class="player-info">
                <div class="player-avatar">å—</div>
                <div>
                    <div class="player-name">Justin</div>
                    <div class="position-indicator">ä½ç½®: <span id="player1Position">1</span></div>
                </div>
            </div>
            <div class="player-stats">
                <div class="stat">
                    <div class="stat-label">å¾—åˆ†</div>
                    <div class="stat-value" id="player1Score">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">å®Œæˆä»»åŠ¡</div>
                    <div class="stat-value" id="player1Completed">0</div>
                </div>
            </div>
        </div>
        
        <div class="player-card player2" id="player2Card">
            <div class="player-info">
                <div class="player-avatar">ğŸ‘¨</div>
                <div>
                    <div class="player-name">Austin</div>
                    <div class="position-indicator">ä½ç½®: <span id="player2Position">1</span></div>
                </div>
            </div>
            <div class="player-stats">
                <div class="stat">
                    <div class="stat-label">å¾—åˆ†</div>
                    <div class="stat-value" id="player2Score">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">å®Œæˆä»»åŠ¡</div>
                    <div class="stat-value" id="player2Completed">0</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ£‹ç›˜åŒºåŸŸ -->
    <div class="board-container">
        <div class="board" id="gameBoard"></div>
    </div>
    
    <!-- æ¸¸æˆæ§åˆ¶ -->
    <div class="game-controls">
        <div class="turn-indicator" id="turnIndicator">ğŸ‘© Justinçš„å›åˆ</div>
        
        <div class="dice-section">
            <div class="dice" id="dice">ğŸ²</div>
            <div class="dice-result" id="diceResult">ç‚¹å‡»æ·éª°å­</div>
        </div>
        
        <div class="task-panel">
            <div class="task-header">
                <div class="task-title">å½“å‰ä»»åŠ¡</div>
                <div class="position-indicator" id="currentPosition">ä½ç½®: 1</div>
            </div>
            <div class="task-text" id="taskText">
                ç‚¹å‡»éª°å­å¼€å§‹æ¸¸æˆï¼ŒæŒ‰ç…§æ·å‡ºçš„ç‚¹æ•°ç§»åŠ¨ï¼Œå®Œæˆç›¸åº”ä½ç½®çš„ç§å¯†äº’åŠ¨ä»»åŠ¡ã€‚
            </div>
            <div class="action-buttons" id="actionButtons" style="display: none;">
                <div class="action-btn-row">
                    <button class="action-btn complete-btn" id="completeBtn">
                        <span>âœ…</span> å·²å®Œæˆ
                    </button>
                    <button class="action-btn skip-btn" id="skipBtn">
                        <span>â­ï¸</span> è·³è¿‡
                    </button>
                </div>
                <div class="skip-count" id="skipCount"></div>
            </div>
        </div>
    </div>
    
    <!-- æ¸¸æˆä¿¡æ¯ -->
    <div class="game-info">
        <div class="info-item">
            <div class="info-label">å½“å‰å›åˆ</div>
            <div class="info-value" id="currentRound">1</div>
        </div>
        <div class="info-item">
            <div class="info-label">å‰©ä½™ä»»åŠ¡</div>
            <div class="info-value" id="remainingTasks">30</div>
        </div>
        <div class="info-item">
            <div class="info-label">æ€»åˆ†æ•°</div>
            <div class="info-value" id="totalScore">0</div>
        </div>
        <div class="info-item">
            <div class="info-label">æ€»æ­¥æ•°</div>
            <div class="info-value" id="totalMoves">0</div>
        </div>
    </div>
    
    <!-- é‡ç½®æŒ‰é’® -->
    <button class="reset-btn" id="resetBtn">
        <span>ğŸ”„</span> é‡æ–°å¼€å§‹æ¸¸æˆ
    </button>
    
    <!-- æ¸¸æˆç»“æŸæ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="gameOverModal">
        <div class="modal">
            <div class="modal-title" id="modalTitle">æ¸¸æˆç»“æŸ</div>
            <div class="modal-content" id="modalContent">
                æ¸¸æˆç»“æŸï¼Œç­‰å¾…ç»“æœæ˜¾ç¤º...
            </div>
            <button class="modal-btn" id="modalBtn">å†æ¥ä¸€å±€</button>
        </div>
    </div>
    
    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <div class="footer">
        ä¸“ä¸ºæƒ…ä¾£è®¾è®¡çš„ç§å¯†äº’åŠ¨æ¸¸æˆ<br>
        æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡å¯è·å¾—2åˆ†<br>
        å»ºè®®åœ¨ç§å¯†ç¯å¢ƒä¸­è¿›è¡Œ
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            currentPlayer: 1,
            round: 1,
            diceValue: 0,
            gameOver: false,
            totalMoves: 0,
            taskAssigned: false,
            taskCompleted: false,
            currentTaskIndex: -1,
            
            player1: {
                position: 0,
                score: 0,
                completedTasks: 0,
                skipChances: 3
            },
            
            player2: {
                position: 0,
                score: 0,
                completedTasks: 0,
                skipChances: 3
            },
            
            tasks: [],
            completedTaskIndices: new Set(),
            remainingTasks: 0
        };
        
        // DOMå…ƒç´ 
        const board = document.getElementById('gameBoard');
        const dice = document.getElementById('dice');
        const diceResult = document.getElementById('diceResult');
        const taskText = document.getElementById('taskText');
        const resetBtn = document.getElementById('resetBtn');
        const actionButtons = document.getElementById('actionButtons');
        const completeBtn = document.getElementById('completeBtn');
        const skipBtn = document.getElementById('skipBtn');
        const turnIndicator = document.getElementById('turnIndicator');
        const currentPosition = document.getElementById('currentPosition');
        const skipCount = document.getElementById('skipCount');
        
        // ç©å®¶ä¿¡æ¯å…ƒç´ 
        const player1Card = document.getElementById('player1Card');
        const player2Card = document.getElementById('player2Card');
        const player1Position = document.getElementById('player1Position');
        const player2Position = document.getElementById('player2Position');
        const player1Score = document.getElementById('player1Score');
        const player2Score = document.getElementById('player2Score');
        const player1Completed = document.getElementById('player1Completed');
        const player2Completed = document.getElementById('player2Completed');
        const currentRound = document.getElementById('currentRound');
        const remainingTasks = document.getElementById('remainingTasks');
        const totalScore = document.getElementById('totalScore');
        const totalMoves = document.getElementById('totalMoves');
        
        // æ¨¡æ€æ¡†å…ƒç´ 
        const gameOverModal = document.getElementById('gameOverModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const modalBtn = document.getElementById('modalBtn');
        
        // ä»»åŠ¡åˆ—è¡¨
        const allTasks = [
            "æ·±æƒ…æ‹¥å»3åˆ†é’Ÿï¼Œä¸è®¸ä¸­æ–­ğŸ’‹",
            "å»switchæ‰¾jadenï¼Œåœ¨ä»–é¢å‰èˆŒå»",
            "ç»™å¯¹æ–¹åšä¸€æ¬¡å…¨èº«æ”¾æ¾æŒ‰æ‘©ï¼ˆç”¨ä½ é‚£æ¡ï¼‰ğŸ’†â€â™€ï¸",
            "äº’ç›¸æ¸©æŸ”æŠšæ‘¸ï¼Œæ„Ÿå—å½¼æ­¤çš„ä½“æ¸©â¤ï¸",
            "å°è¯•ä¸€ä¸ªæ–°çš„äº²å¯†å§¿åŠ¿ï¼Œæ…¢æ…¢æ¢ç´¢âœ¨",
            "å’¬å¯¹æ–¹çš„è€³å‚ï¼Œè½»ä¸€ç‚¹å“¦ğŸ˜˜",
             "ç»™å¯¹æ–¹çœ‹ä¸‹é¢ğŸ‘€",
            "ç”¨èˆŒå°–èˆ”å¯¹æ–¹ä¸‹é¢ğŸ‘„",
            "ä»é¢å¤´å¼€å§‹ï¼Œå»éå¯¹æ–¹çš„æ¯ä¸€å¯¸è‚Œè‚¤ğŸŒ¿",
            "ä¸€èµ·æ´—ä¸ªé¸³é¸¯æµ´ï¼Œäº’ç›¸å¸®å¿™æ¸…æ´ğŸ›",
            "å»å…¬å›­åƒé¸¡",
            "æ‹ä¸€å¼ äº²å¯†ç…§",
            "è·Ÿå¯¹æ–¹åšçˆ±ğŸ’˜",
            "äº’ç›¸ä¾åï¼Œç”¨èº«ä½“æ„Ÿå—å½¼æ­¤çš„å¿ƒè·³ğŸ«€",
            "äº’ç›¸æŒ‰æ‘©ï¼ŒæŒ‰æ‘©åˆ°ç¡¬ğŸ¦¶",
            "è£¸èº«ç›¸æ‹¥5åˆ†é’Ÿï¼Œä¸åšå…¶ä»–åŠ¨ä½œï¼Œåªæ„Ÿå—å½¼æ­¤ğŸ¤",
            "ä¸€èµ·èººåœ¨åºŠä¸Šï¼Œåšçˆ±åšçš„äº‹âœˆï¸",
            "è½»æ‹å¯¹æ–¹çš„è‡€éƒ¨ï¼Œç„¶åæ¸©æŸ”æŠšæ‘¸ğŸ‘",
            "åœ¨jadené¢å‰å…¨è£¸è·³èˆğŸ‘ƒ",
            "èˆ”è…¹è‚Œ",
            "åƒé¸¡ğŸŒ¬ï¸",
            "ç”¨å˜´å·´è„±å¯¹æ–¹çš„è£¤å­ğŸ’Œ",
            "æŠ±æŠ±ä¸€åˆ†é’Ÿ",
	    "æ‹ç‰µæ‰‹ç…§",
	    "èˆŒå»30ç§’",
	    "è½»å’¬å¯¹æ–¹çš„ä¹³å¤´ï¼Œæ„Ÿå—ååº”ğŸ˜",
	    "èˆ”å¯¹æ–¹é¾Ÿå¤´3åˆ†é’Ÿ",
	    "æ·±å–‰å£äº¤ï¼Œå«åˆ°æœ€æ·±å¤„ğŸ˜®",
	    "ç”¨èˆŒå¤´ç”»åœˆèˆ”é¾Ÿå¤´ğŸ‘…",
	    "ç”Ÿæ®–å™¨è´´ç€ç”Ÿæ®–å™¨ä¸Šä¸‹æ»‘åŠ¨ğŸ”„",
	    "æ‘¸æ‘¸å¤´",
	    "èˆ”é¾Ÿå¤´",
	    "èˆŒå»ä¸€åˆ†é’Ÿ",
        "é¾Ÿå¤´æ‘©é¾Ÿå¤´1åˆ†é’Ÿ",
        "èˆ”ä¹³å¤´30ç§’",
        "å¸®å¯¹æ–¹è„±è£¤å­",
        "ç»™å¯¹æ–¹å£äº¤3åˆ†é’Ÿ",
        "æ·±å–‰å£äº¤1åˆ†é’Ÿ",
        "èˆŒå»3åˆ†é’Ÿ",
        "æ‰å¯¹æ–¹å¥¶å¤´1åˆ†é’Ÿ",
        "åŠæ”¾åœ¨å¯¹æ–¹çš„å±çœ¼ä¸Šæ‘©æ“¦2åˆ†é’Ÿ",
        "èˆŒå»5åˆ†é’Ÿ"
                    ];
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            gameState.currentPlayer = 1;
            gameState.round = 1;
            gameState.diceValue = 0;
            gameState.gameOver = false;
            gameState.totalMoves = 0;
            gameState.taskAssigned = false;
            gameState.taskCompleted = false;
            gameState.currentTaskIndex = -1;
            
            gameState.player1 = {
                position: 0,
                score: 0,
                completedTasks: 0,
                skipChances: 3
            };
            
            gameState.player2 = {
                position: 0,
                score: 0,
                completedTasks: 0,
                skipChances: 3
            };
            
            gameState.tasks = [...allTasks];
            gameState.completedTaskIndices = new Set();
            gameState.remainingTasks = gameState.tasks.length;
            
            updatePlayerDisplay();
            updateGameInfo();
            createBoard();
            
            taskText.textContent = "ç‚¹å‡»éª°å­è·å¾—ä»»åŠ¡ï¼Œå®Œæˆä»»åŠ¡åå°±èƒ½å‰è¿›ä¸€æ ¼ï¼";
            actionButtons.style.display = "none";
            turnIndicator.textContent = "ğŸ‘© ç©å®¶ä¸€çš„å›åˆ";
            
            player1Card.classList.add("active");
            player2Card.classList.remove("active");
            
            dice.style.pointerEvents = "auto";
            dice.classList.remove("rolling");
            diceResult.textContent = "ç‚¹å‡»æ·éª°å­";
            
            // éšè—æ¸¸æˆç»“æŸæ¨¡æ€æ¡†
            gameOverModal.classList.remove("active");
        }
        
        // åˆ›å»ºæ£‹ç›˜
        function createBoard() {
            board.innerHTML = '';
            
            for (let i = 0; i < 64; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${i}`;
                
                // æ ¼å­ç¼–å·
                const number = document.createElement('div');
                number.className = 'cell-number';
                number.textContent = i + 1;
                cell.appendChild(number);
                
                // æ£€æŸ¥æ˜¯å¦æœ‰ç©å®¶åœ¨è¿™ä¸ªæ ¼å­
                const player1Here = gameState.player1.position === i;
                const player2Here = gameState.player2.position === i;
                
                if (player1Here || player2Here) {
                    if (player1Here) {
                        const marker1 = document.createElement('div');
                        marker1.className = 'player-marker player1-marker';
                        marker1.textContent = '1';
                        cell.appendChild(marker1);
                    }
                    
                    if (player2Here) {
                        const marker2 = document.createElement('div');
                        marker2.className = 'player-marker player2-marker';
                        marker2.textContent = '2';
                        cell.appendChild(marker2);
                    }
                }
                
                board.appendChild(cell);
            }
        }
        
        // æ·éª°å­ - åˆ†é…ä»»åŠ¡
        function rollDice() {
            if (gameState.gameOver) return;
            if (gameState.taskAssigned && !gameState.taskCompleted) return; // ä»»åŠ¡æœªå®Œæˆï¼Œä¸èƒ½å†æ·
            
            dice.style.pointerEvents = "none";
            dice.classList.add("rolling");
            taskText.textContent = "æ·éª°å­ä¸­...";
            diceResult.textContent = "æ·éª°å­ä¸­...";
            actionButtons.style.display = "none";
            
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
            
            setTimeout(() => {
                // åˆ†é…ä¸€ä¸ªæœªå®Œæˆçš„ä»»åŠ¡
                const availableIndices = [];
                for (let i = 0; i < gameState.tasks.length; i++) {
                    if (!gameState.completedTaskIndices.has(i)) {
                        availableIndices.push(i);
                    }
                }
                
                if (availableIndices.length === 0) {
                    // æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆäº†
                    checkWinCondition();
                    dice.classList.remove("rolling");
                    return;
                }
                
                const randomIndex = Math.floor(Math.random() * availableIndices.length);
                gameState.currentTaskIndex = availableIndices[randomIndex];
                const task = gameState.tasks[gameState.currentTaskIndex];
                
                gameState.taskAssigned = true;
                gameState.taskCompleted = false;
                gameState.totalMoves++;
                diceResult.textContent = `ä»»åŠ¡å·²åˆ†é…`;
                
                taskText.textContent = task;
                actionButtons.style.display = "flex";
                
                updateSkipCountDisplay();
                updateGameInfo();
                
                dice.classList.remove("rolling");
                
                if (navigator.vibrate) {
                    navigator.vibrate([50, 30, 50]);
                }
            }, 600);
        }
        
        // ç§»åŠ¨å½“å‰ç©å®¶
        function moveCurrentPlayer() {
            const player = gameState.currentPlayer === 1 ? gameState.player1 : gameState.player2;
            player.position++;
            
            if (player.position > 63) {
                player.position = 63;
            }
        }
        
        // æ˜¾ç¤ºå½“å‰ä½ç½®çš„ä»»åŠ¡
        function showTaskForCurrentPosition() {
            const player = gameState.currentPlayer === 1 ? gameState.player1 : gameState.player2;
            const position = player.position;
            
            currentPosition.textContent = `ä½ç½®: ${position + 1}`;
            
            // æ›´æ–°è·³è¿‡æ¬¡æ•°æ˜¾ç¤º
            updateSkipCountDisplay();
            
            if (player.completedPositions.has(position)) {
                taskText.textContent = `âœ… ä½ç½® ${position + 1}: æ‚¨å·²ç»åœ¨æ­¤å®Œæˆè¿‡ä»»åŠ¡`;
                actionButtons.style.display = "none";
                return;
            }
            
            let task = gameState.positionTasks[position];
            
            if (!task) {
                const availableIndices = [];
                for (let i = 0; i < gameState.tasks.length; i++) {
                    if (!gameState.usedTaskIndices.has(i)) {
                        availableIndices.push(i);
                    }
                }
                
                if (availableIndices.length > 0) {
                    const randomIndex = Math.floor(Math.random() * availableIndices.length);
                    const taskIndex = availableIndices[randomIndex];
                    task = gameState.tasks[taskIndex];
                    
                    gameState.usedTaskIndices.add(taskIndex);
                    gameState.remainingTasks--;
                    gameState.positionTasks[position] = task;
                } else {
                    task = "æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼è‡ªç”±é€‰æ‹©ä¸€ä¸ªäº²å¯†äº’åŠ¨å§ï¼";
                }
            }
            
            taskText.textContent = task;
        }
        
        // å®Œæˆä»»åŠ¡
        function completeTask() {
            if (!gameState.taskAssigned) return;
            
            const player = gameState.currentPlayer === 1 ? gameState.player1 : gameState.player2;
            
            // æ ‡è®°ä»»åŠ¡ä¸ºå·²å®Œæˆ
            gameState.completedTaskIndices.add(gameState.currentTaskIndex);
            
            // ç§»åŠ¨ç©å®¶å‰è¿›ä¸€æ ¼
            moveCurrentPlayer();
            player.completedTasks++;
            player.score += 2;
            
            gameState.taskCompleted = true;
            gameState.taskAssigned = false;
            gameState.remainingTasks = gameState.tasks.length - gameState.completedTaskIndices.size;
            
            updatePlayerDisplay();
            updateGameInfo();
            createBoard();
            
            taskText.textContent = `âœ… å®Œæˆä»»åŠ¡ï¼+2åˆ† | å‰è¿›è‡³ç¬¬ ${player.position + 1} æ ¼`;
            actionButtons.style.display = "none";
            
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
            
            checkWinCondition();
            
            if (!gameState.gameOver) {
                setTimeout(() => {
                    switchPlayer();
                }, 1500);
            }
        }
        
        // è·³è¿‡ä»»åŠ¡
        function skipTask() {
            if (!gameState.taskAssigned) return;
            
            const player = gameState.currentPlayer === 1 ? gameState.player1 : gameState.player2;
            
            if (player.skipChances <= 0) {
                taskText.textContent = `âŒ è·³è¿‡æœºä¼šå·²ç”¨å®Œï¼å¿…é¡»å®Œæˆæ­¤ä»»åŠ¡`;
                return;
            }
            
            player.skipChances--;
            
            // æ ‡è®°ä»»åŠ¡ä¸ºå·²å®Œæˆï¼ˆè¿™æ ·å°±ä¸ä¼šå†å‡ºç°è¿™ä¸ªä»»åŠ¡ï¼‰
            gameState.completedTaskIndices.add(gameState.currentTaskIndex);
            gameState.remainingTasks = gameState.tasks.length - gameState.completedTaskIndices.size;
            
            gameState.taskCompleted = true;
            gameState.taskAssigned = false;
            
            taskText.textContent = `â­ï¸ å·²è·³è¿‡ (å‰©ä½™${player.skipChances}æ¬¡)`;
            actionButtons.style.display = "none";
            
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
            
            updatePlayerDisplay();
            updateGameInfo();
            
            setTimeout(() => {
                switchPlayer();
            }, 800);
        }
        
        // åˆ‡æ¢ç©å®¶
        function switchPlayer() {
            gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
            
            if (gameState.currentPlayer === 1) {
                gameState.round++;
            }
            
            updatePlayerDisplay();
            updateGameInfo();
            
            if (gameState.currentPlayer === 1) {
                turnIndicator.textContent = "ğŸ‘© ç©å®¶ä¸€çš„å›åˆ";
                player1Card.classList.add("active");
                player2Card.classList.remove("active");
            } else {
                turnIndicator.textContent = "ğŸ‘¨ ç©å®¶äºŒçš„å›åˆ";
                player2Card.classList.add("active");
                player1Card.classList.remove("active");
            }
            
            diceResult.textContent = "ç‚¹å‡»æ·éª°å­";
            taskText.textContent = `ç©å®¶ ${gameState.currentPlayer} çš„å›åˆï¼Œç‚¹å‡»éª°å­è·å–ä»»åŠ¡ï¼`;
            
            if (!gameState.gameOver) {
                dice.style.pointerEvents = "auto";
            }
        }
        
        // æ£€æŸ¥è·èƒœæ¡ä»¶
        function checkWinCondition() {
            if (gameState.remainingTasks <= 0 || gameState.completedTaskIndices.size >= gameState.tasks.length) {
                gameState.gameOver = true;
                
                let winner = "";
                let winnerScore = 0;
                
                if (gameState.player1.score > gameState.player2.score) {
                    winner = "ç©å®¶ä¸€";
                    winnerScore = gameState.player1.score;
                } else if (gameState.player2.score > gameState.player1.score) {
                    winner = "ç©å®¶äºŒ";
                    winnerScore = gameState.player2.score;
                } else {
                    winner = "åŒæ–¹å¹³å±€";
                    winnerScore = gameState.player1.score;
                }
                
                // æ˜¾ç¤ºæ¸¸æˆç»“æŸæ¨¡æ€æ¡†
                modalTitle.textContent = "ğŸ‰ æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼";
                
                if (winner === "åŒæ–¹å¹³å±€") {
                    modalContent.innerHTML = `
                        <div style="margin-bottom: 15px; font-size: 1.3rem;">${winner}ï¼</div>
                        <div>åŒæ–¹å„å¾—${winnerScore}åˆ†</div>
                        <div>ç©å®¶ä¸€: ${gameState.player1.score}åˆ† | ${gameState.player1.completedTasks}ä¸ªä»»åŠ¡</div>
                        <div>ç©å®¶äºŒ: ${gameState.player2.score}åˆ† | ${gameState.player2.completedTasks}ä¸ªä»»åŠ¡</div>
                        <div style="margin-top: 15px;">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å†æ¥ä¸€å±€</div>
                    `;
                } else {
                    modalContent.innerHTML = `
                        <div style="margin-bottom: 15px; font-size: 1.3rem;">${winner}è·èƒœï¼</div>
                        <div>å¾—åˆ†: ${winnerScore}åˆ†</div>
                        <div>å®Œæˆ${winner === "ç©å®¶ä¸€" ? gameState.player1.completedTasks : gameState.player2.completedTasks}ä¸ªä»»åŠ¡</div>
                        <div style="margin-top: 15px;">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å†æ¥ä¸€å±€</div>
                    `;
                }
                
                gameOverModal.classList.add("active");
                actionButtons.style.display = "none";
                dice.style.pointerEvents = "none";
            }
        }
        
        // æ›´æ–°ç©å®¶ä¿¡æ¯æ˜¾ç¤º
        function updatePlayerDisplay() {
            player1Position.textContent = gameState.player1.position + 1;
            player1Score.textContent = gameState.player1.score;
            player1Completed.textContent = gameState.player1.completedTasks;
            
            player2Position.textContent = gameState.player2.position + 1;
            player2Score.textContent = gameState.player2.score;
            player2Completed.textContent = gameState.player2.completedTasks;
        }
        
        // æ›´æ–°è·³è¿‡æ¬¡æ•°æ˜¾ç¤º
        function updateSkipCountDisplay() {
            const player = gameState.currentPlayer === 1 ? gameState.player1 : gameState.player2;
            const playerName = gameState.currentPlayer === 1 ? "ç©å®¶ä¸€" : "ç©å®¶äºŒ";
            
            if (player.skipChances > 0) {
                skipBtn.disabled = false;
                skipCount.textContent = `${playerName}çš„è·³è¿‡æœºä¼š: ${player.skipChances}/3`;
            } else {
                skipBtn.disabled = true;
                skipCount.textContent = `${playerName}çš„è·³è¿‡æœºä¼šå·²ç”¨å®Œï¼Œå¿…é¡»å®Œæˆä»»åŠ¡ï¼`;
            }
        }
        
        // æ›´æ–°æ¸¸æˆä¿¡æ¯
        function updateGameInfo() {
            currentRound.textContent = gameState.round;
            remainingTasks.textContent = gameState.remainingTasks;
            totalScore.textContent = gameState.player1.score + gameState.player2.score;
            totalMoves.textContent = gameState.totalMoves;
        }
        
        // äº‹ä»¶ç›‘å¬
        dice.addEventListener("click", rollDice);
        resetBtn.addEventListener("click", initGame);
        completeBtn.addEventListener("click", completeTask);
        skipBtn.addEventListener("click", skipTask);
        modalBtn.addEventListener("click", () => {
            gameOverModal.classList.remove("active");
            initGame();
        });
        
        // è§¦æ‘¸åé¦ˆä¼˜åŒ–
        [dice, completeBtn, skipBtn, resetBtn, modalBtn].forEach(button => {
            button.addEventListener("touchstart", function() {
                this.style.opacity = "0.8";
            });
            
            button.addEventListener("touchend", function() {
                this.style.opacity = "1";
            });
        });
        
        // é˜²æ­¢åŒå‡»ç¼©æ”¾
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
        
    </script>
</body>
</html>
